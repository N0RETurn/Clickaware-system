{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-4">{{ tutorial_title }} - Quiz</h2>
    
    <div class="progress mb-4">
        <div class="progress-bar" role="progressbar" 
             style="width: {{ (current_question_index / total_questions) * 100 }}%" 
             aria-valuenow="{{ current_question_index }}" 
             aria-valuemin="0" 
             aria-valuemax="{{ total_questions }}">
            Question {{ current_question_index }} of {{ total_questions }}
        </div>
    </div>

    <div id="flash-messages">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }} alert-dismissible fade show">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
    </div>

    <style>
        .form-check-input {
            position: static !important;
            opacity: 1 !important;
            margin-right: 0.5em;
        }
    </style>

    <form id="quizForm" method="POST" action="{{ url_for('submit_question') }}">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <input type="hidden" name="tutorial_num" value="{{ tutorial }}">
        <input type="hidden" name="question_index" value="{{ current_question_index }}">
        
        <div class="card mb-3 question-card">
            <div class="card-body">
                <h5 class="card-title">{{ current_question_index }}. {{ question.question }}</h5>

                {% for option in question.options %}
                <div class="form-check">
                    <input class="form-check-input"
                           type="radio"
                           name="answer"
                           id="option{{ loop.index }}"
                           value="{{ option }}"
                           required>
                    <label class="form-check-label" for="option{{ loop.index }}">
                        {{ option }}
                    </label>
                </div>
                {% endfor %}
            </div>
        </div>

        <button id="submitBtn" type="submit" class="btn btn-primary btn-lg">
            {% if current_question_index == total_questions %}
                Submit Quiz
            {% else %}
                Next Question
            {% endif %}
        </button>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const quizForm = document.getElementById('quizForm');
    
    quizForm.addEventListener('submit', function(e) {
        const selectedOption = quizForm.querySelector('input[name="answer"]:checked');
        if (!selectedOption) {
            e.preventDefault();
            showFlashMessage('Please select an answer before continuing', 'danger');
        }
    });

    function showFlashMessage(message, category) {
        const alertDiv = document.createElement('div');
        alertDiv.className = `alert alert-${category} alert-dismissible fade show`;
        alertDiv.innerHTML = `${message}<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>`;
        document.getElementById('flash-messages').prepend(alertDiv);
    }
});
</script>
{% endblock %}