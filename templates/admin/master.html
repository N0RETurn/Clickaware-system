{% extends 'admin/base.html' %}

{% block head_css %}
    {{ super() }}
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
    <style>
        .navbar-brand {
            font-weight: bold;
        }

        /* Manual dark mode toggle styles */
        body.dark-mode {
            background-color: #2d2d2d !important;
            color: #f0f0f0 !important;
        }

        .dark-mode .navbar,
        .dark-mode .sidebar,
        .dark-mode .panel,
        .dark-mode .content {
            background-color: #1f1f1f !important;
            color: #ffffff !important;
        }

        .dark-mode a,
        .dark-mode .nav > li > a {
            color: #ffffff !important;
        }
    </style>
{% endblock %}

{% block head %}
    {{ super() }}
    <!-- Custom head content -->
    <meta name="description" content="Cyber Security Admin Panel">
    <link rel="icon" href="{{ url_for('static', filename='img/favicon.ico') }}">
{% endblock %}

{% block navbar %}
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container-fluid">
    <a class="navbar-brand" href="{{ url_for('admin.index') }}">Cyber Admin</a>
    
    <div class="d-flex ms-auto">
      {% if current_user.is_authenticated %}
      <a class="btn btn-outline-light me-2" href="{{ url_for('logout') }}">Logout</a>
      {% endif %}
      <button class="btn btn-outline-light" id="darkModeToggle">Toggle Dark Mode</button>
    </div>
  </div>
</nav>
{% endblock %}

{% block page_body %}
    <div class="container-fluid">
        {% block messages %}
            {{ layout.messages() }}
        {% endblock %}
        
        {% set render_ctx = h.resolve_ctx() %}
        
        {% block body %}
            {{ super() }}
        {% endblock %}
    </div>
{% endblock %}

{% block tail %}
    {{ super() }}
    <!-- Custom JavaScript -->
    <script src="{{ url_for('static', filename='js/admin.js') }}"></script>
    <script>
        // Dark mode toggle and persistence
        document.addEventListener('DOMContentLoaded', function () {
            if (localStorage.getItem("dark-mode") === "true") {
                document.body.classList.add("dark-mode");
            }

            const toggle = document.getElementById("darkModeToggle");
            if (toggle) {
                toggle.addEventListener("click", function () {
                    document.body.classList.toggle("dark-mode");
                    localStorage.setItem("dark-mode", document.body.classList.contains("dark-mode"));
                });
            }

            console.log('Admin panel loaded');
        });
    </script>
{% endblock %}
